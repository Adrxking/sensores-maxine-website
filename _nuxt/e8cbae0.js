(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{489:function(e,t,n){"use strict";n.r(t);n(26),n(31);var c,l=n(6),o=n(18),r=(n(267),n(42),n(119)),d=n.n(r),m=(n(268),n(122)),v=n.n(m),h=(n(456),n(457)),f=n.n(h),y=(n(458),n(459)),w=n.n(y),x={middleware:"authenticated",components:(c={},Object(o.a)(c,w.a.name,w.a),Object(o.a)(c,f.a.name,f.a),Object(o.a)(c,v.a.name,v.a),Object(o.a)(c,d.a.name,d.a),c),data:function(){return{templates:[],selectedIndexTemplate:null,newDevice:{name:"",dId:"",templateId:"",templateName:""}}},mounted:function(){this.getTemplates()},methods:Object(o.a)({updateSaverRuleStatus:function(e){var t=this,n=JSON.parse(JSON.stringify(e));n.status=!n.status;var c={rule:n},l={headers:{token:this.$store.state.auth.token}};this.$axios.put("/saver-rule",c,l).then((function(e){"success"==e.data.status&&(t.$store.dispatch("getDevices"),t.$notify({type:"success",icon:"tim-icons icon-check-2",message:" Device Saver Status Updated"}))})).catch((function(e){console.log(e),t.$notify({type:"danger",icon:"tim-icons icon-alert-circle-exc",message:" Error updating saver rule status"})}))},deleteDevice:function(e){var t=this,n={headers:{token:this.$store.state.auth.accessToken},params:{dId:e.dId}};this.$axios.delete("/device",n).then((function(n){"success"==n.data.status&&t.$notify({type:"success",icon:"tim-icons icon-check-2",message:e.name+" eliminado!"}),$nuxt.$emit("time-to-get-devices")})).catch((function(n){console.log(n),t.$notify({type:"danger",icon:"tim-icons icon-alert-circle-exc",message:" Error deleting "+e.name})}))},createNewDevice:function(){var e=this;if(""!=this.newDevice.name)if(""!=this.newDevice.dId)if(null!=this.selectedIndexTemplate){var t={headers:{token:this.$store.state.auth.token}};this.newDevice.templateId=this.templates[this.selectedIndexTemplate]._id,this.newDevice.templateName=this.templates[this.selectedIndexTemplate].name;var n={newDevice:this.newDevice};this.$axios.post("/device",n,t).then((function(t){if("success"==t.data.status)return e.$store.dispatch("getDevices"),e.newDevice.name="",e.newDevice.dId="",e.selectedIndexTemplate=null,void e.$notify({type:"success",icon:"tim-icons icon-check-2",message:"Success! Device was added"})})).catch((function(t){return"error"==t.response.data.status&&"unique"==t.response.data.error.errors.dId.kind?void e.$notify({type:"warning",icon:"tim-icons icon-alert-circle-exc",message:"The device is already registered in the system. Try another device"}):void e.showNotify("danger","Error")}))}else this.$notify({type:"warning",icon:"tim-icons icon-alert-circle-exc",message:" Tempalte must be selected"});else this.$notify({type:"warning",icon:"tim-icons icon-alert-circle-exc",message:" Device ID is Empty :("});else this.$notify({type:"warning",icon:"tim-icons icon-alert-circle-exc",message:" Device Name is Empty :("})},getTemplates:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var n,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{token:e.$store.state.auth.token}},t.prev=1,t.next=4,e.$axios.get("/template",n);case 4:c=t.sent,console.log(c.data),"success"==c.data.status&&(e.templates=c.data.data),t.next=14;break;case 9:return t.prev=9,t.t0=t.catch(1),e.$notify({type:"danger",icon:"tim-icons icon-alert-circle-exc",message:"Error getting templates..."}),console.log(t.t0),t.abrupt("return");case 14:case"end":return t.stop()}}),t,null,[[1,9]])})))()}},"deleteDevice",(function(e){var t=this,n={headers:{token:this.$store.state.auth.token},params:{dId:e.dId}};this.$axios.delete("/device",n).then((function(n){"success"==n.data.status&&(t.$notify({type:"success",icon:"tim-icons icon-check-2",message:e.name+" deleted!"}),t.$store.dispatch("getDevices"))})).catch((function(n){console.log(n),t.$notify({type:"danger",icon:"tim-icons icon-alert-circle-exc",message:" Error deleting "+e.name})}))}))},$=n(1),component=Object($.a)(x,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"row"},[n("card",[n("div",{attrs:{slot:"header"},slot:"header"},[n("h4",{staticClass:"card-title"},[e._v("Añade un nuevo dispositivo")])]),e._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4"},[n("base-input",{attrs:{label:"Nombre del dispositivo",type:"text",placeholder:"Ej: Casa, Oficina..."},model:{value:e.newDevice.name,callback:function(t){e.$set(e.newDevice,"name",t)},expression:"newDevice.name"}})],1),e._v(" "),n("div",{staticClass:"col-4"},[n("base-input",{attrs:{label:"ID del dispositivo",type:"text",placeholder:"Ej: 7777-8888"},model:{value:e.newDevice.dId,callback:function(t){e.$set(e.newDevice,"dId",t)},expression:"newDevice.dId"}})],1),e._v(" "),n("div",{staticClass:"col-4"},[e._t("label",[n("label",[e._v(" Plantilla ")])]),e._v(" "),n("el-select",{staticClass:"select-primary",staticStyle:{width:"100%"},attrs:{placeholder:"Seleccionar Plantilla"},model:{value:e.selectedIndexTemplate,callback:function(t){e.selectedIndexTemplate=t},expression:"selectedIndexTemplate"}},e._l(e.templates,(function(template,e){return n("el-option",{key:template._id,staticClass:"text-dark",attrs:{value:e,label:template.name}})})),1)],2)]),e._v(" "),n("div",{staticClass:"row pull-right"},[n("div",{staticClass:"col-12"},[n("base-button",{staticClass:"mb-3",attrs:{type:"primary",size:"lg"},on:{click:function(t){return e.createNewDevice()}}},[e._v("Añadir")])],1)])])],1),e._v(" "),n("div",{staticClass:"row"},[n("card",[n("div",{attrs:{slot:"header"},slot:"header"},[n("h4",{staticClass:"card-title"},[e._v("Dispositivos")])]),e._v(" "),n("el-table",{attrs:{data:e.$store.state.devices}},[n("el-table-column",{attrs:{label:"#","min-width":"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){t.row;var c=t.$index;return n("div",{},[e._v("\n            "+e._s(c+1)+"\n          ")])}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"Nombre"}}),e._v(" "),n("el-table-column",{attrs:{prop:"dId",label:"Id Dispositivo"}}),e._v(" "),n("el-table-column",{attrs:{prop:"password",label:"Contraseña"}}),e._v(" "),n("el-table-column",{attrs:{prop:"templateName",label:"Plantilla"}}),e._v(" "),n("el-table-column",{attrs:{label:"Actions"},scopedSlots:e._u([{key:"default",fn:function(t){var c=t.row;t.$index;return n("div",{},[n("el-tooltip",{staticStyle:{"margin-right":"10px"},attrs:{content:"Indicador Estado del Servidor"}},[n("i",{staticClass:"fas fa-database ",class:{"text-success":c.saverRule.status,"text-dark":!c.saverRule.status}})]),e._v(" "),n("el-tooltip",{attrs:{content:"Guardar en la base de datos"}},[n("base-switch",{attrs:{value:c.saverRule.status,type:"primary","on-text":"On","off-text":"Off"},on:{click:function(t){return e.updateSaverRuleStatus(c.saverRule)}}})],1),e._v(" "),n("el-tooltip",{attrs:{content:"Eliminar",effect:"light","open-delay":300,placement:"top"}},[n("base-button",{staticClass:"btn-link",attrs:{type:"danger",icon:"",size:"sm"},on:{click:function(t){return e.deleteDevice(c)}}},[n("i",{staticClass:"tim-icons icon-simple-remove "})])],1)],1)}}])})],1)],1)],1)])}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{BaseInput:n(74).default,BaseButton:n(73).default,Card:n(72).default,BaseSwitch:n(165).default})}}]);